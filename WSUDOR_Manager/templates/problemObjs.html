{% include 'header.html' %}
<script>
$(document).ready(function () {

    // add workspace and remove object button actions
    $(function(APP_HOST)
    {
        $(document).on('click', '.objectEdit', function(e)
        {
            e.preventDefault();
            button = this.id;
            var pid = $(this).closest("div").attr("id");
            if (button == "removeButton") {
                var action="removeObj";
            }
            if (button == "addButton") {
                var action="claimObj";
            }

            $.ajax({
                url: "/{{APP_PREFIX}}/"+action,
                type: "POST",
                data:{"pid":"wayne:"+pid}
            }).done(function(response) { $("#"+pid).fadeToggle("slow", "linear"); location.reload(); });

            });

         return false;
     });

    // add modal functionality
    $('#myModal').on('show.bs.modal', function (e) {
      // Button that triggered the modal
      var button = $(e.relatedTarget);
      // Extract info from data-* attributes
      var recipient_email = button.data('email');
      var name = button.data('name');

      // stops modal from being shown if there's no email
      if (email=="None") return e.preventDefault()

      var modal = $(this);
      modal.find('.modal-title').text('New message to ' + name);
      modal.find('.modal-body input#email').val(recipient_email);

    })

    // handle disabling of reply button
    $('button#replyButton').each(function () {
      var email = $(this).attr('data-email');
      console.log($(this).attr('data-email'));
      if (email == "None") {
        $(this).attr('disabled', true);
      }
    });

    });

</script>


<div class="col-md-12 panel" style="text-align:center;"><h3>User-Reported Problem Objects</h3></div>

<script>

</script>

<div class="card-deck-wrapper">
  {%for objs in problemObjs | batch(5) %}
<div class="card-deck">
  {% for obj in objs %}
  {% with prefix, pid = obj.PID.split(':') %}
  <!-- Card -->
  <div class="card" id={{pid}}-{{obj.id}}>
    <a target="_blank" href="//{{APP_HOST}}/digitalcollections/item?id={{obj.PID}}"><img class="card-img-top img-thumbnail" src="//{{APP_HOST}}/fedora/objects/{{obj.PID}}/datastreams/THUMBNAIL/content" alt="{{obj.PID}}"></a>
<p class="card-text" style="padding-left:4px;"><small class="text-muted">{{obj.PID}}</small></p>
    <div class="card-block" style="padding-left:4px;" id={{pid}}-{{obj.id}}>
      <h4 class="card-title">{{obj.solr_package['dc_title'][0]}}</h4>
      {% if obj.notes is not none %}
        {% set name = obj.notes['name'] %}
        {% set email = obj.notes['email'] %}
        {% set message = obj.notes['message'] %}
      {% else %}
        {% set name = "None" %}
        {% set email = "None" %}
        {% set message = "None" %}
      {% endif %}
      <blockquote class="card-blockquote">
        <small>
            <p class="card-text"><cite>name</cite>: {{name}}</p>
            <p class="card-text"><cite>email</cite>: {{email}}</p>
            <p class="card-text"><cite>message</cite>: {{message}}</p>
        </small>
      </blockquote>
        <button id="addButton" class="btn btn-success btn-add objectEdit" style="margin-top: 4px;" type="button">Add to Workspace</button>
        <button id="removeButton" class="btn btn-success btn-danger objectEdit" style="margin-top: 4px;" type="button">Remove</button>
        <button id="replyButton" class="btn btn-success btn-warning" style="margin-top: 4px;" data-toggle="modal" data-name={{name}} data-email={{email}} data-target="#myModal" type="button">Reply</button>
    </div>
  </div>
{% endwith %}

{% endfor %}
</div> <!-- ./card-deck -->
{% endfor %}

</div> <!-- ./card-deck-wrapper -->

<!-- Modal -->
<div id="myModal" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Response</h4>
      </div>
      <div class="modal-body">
        <form class="form-horizontal" role="form" id="form_email" method="POST" action="/{{APP_PREFIX}}/email">
            <div class="col-xs-8">
                <div class="form-group">
                    <label for="email" class="control-label emailLabel col-lg-4 control-label">To</label>
                    <div class="col-lg-8">
                        <input id="email" type="text" name="recipient_email" placeholder="recipient's email" readonly required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="name" class="control-label nameLabel col-lg-4 control-label">From</label>
                    <div class="col-lg-8">
                        <input id="name" type="text" name="your_email" placeholder="Enter your email address" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="message" class="control-label messageLabel col-lg-4 control-label">Message</label>
                    <div class="col-lg-8">
                        <textarea id="message" name="message" placeholder="Your message" required style="margin: 0px; width: 372px; height: 332px;"></textarea>
                    </div>
                </div>
                <button type="submit" form="form_email" class="btn btn-info pull-right">Send Message</button>
            </div> <!-- col-xs-8 -->
        </form>
      </div> <!-- modal-body -->
       <div class="modal-footer"></div>
    </div> <!-- modal-content -->

  </div>
</div>



{% include 'footer.html' %}
